{
  "info": {
    "name": "ViePropChain - Gmail OAuth Flow (NEW)",
    "description": "üÜï Test workflow m·ªõi: Gmail Login ‚Üí KYC ‚Üí Optional Wallet Link ‚Üí NFT Minting\n\n**THAY ƒê·ªîI L·ªöN:**\n- User login b·∫±ng Gmail thay v√¨ MetaMask\n- KYC d√πng userId thay v√¨ wallet\n- Wallet linking l√† OPTIONAL\n- Admin mint NFT cho user",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "0. Setup Instructions",
      "item": [
        {
          "name": "üìñ README - How to Test",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "http://localhost:4010/health",
              "protocol": "http",
              "host": ["localhost"],
              "port": "4010",
              "path": ["health"]
            },
            "description": "## üöÄ H∆Ø·ªöNG D·∫™N TEST GMAIL OAUTH FLOW\n\n### **B∆∞·ªõc 1: Start Services**\n```bash\n# Terminal 1: Auth Service\ncd services/auth-service\nnpm start\n\n# Terminal 2: KYC Service  \ncd services/kyc-service\nnpm start\n\n# Terminal 3: User Service\ncd services/user-service\nnpm start\n\n# Terminal 4: Admin Service\ncd services/admin-service\nnpm start\n\n# Terminal 5: Blockchain Service\ncd services/blockchain-service\nnpm start\n\n# Terminal 6: IPFS Service\ncd services/ipfs-service\nnpm start\n```\n\n### **B∆∞·ªõc 2: Test Google OAuth (MANUAL - D√πng Browser)**\n\n‚ö†Ô∏è **QUAN TR·ªåNG**: Google OAuth KH√îNG TH·ªÇ test trong Postman!\n\nB·∫°n ph·∫£i d√πng **Browser** ƒë·ªÉ test:\n\n1. M·ªü browser, truy c·∫≠p:\n   ```\n   http://localhost:4010/auth/google\n   ```\n\n2. Ch·ªçn t√†i kho·∫£n Gmail ƒë·ªÉ ƒëƒÉng nh·∫≠p\n\n3. Sau khi ƒëƒÉng nh·∫≠p th√†nh c√¥ng, b·∫°n s·∫Ω ƒë∆∞·ª£c redirect v·ªÅ:\n   ```\n   http://localhost:3000?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...\n   ```\n\n4. **Copy JWT token** t·ª´ URL (ph·∫ßn sau `?token=`)\n\n5. Paste token v√†o Postman Environment variable:\n   - Variable name: `jwt_token`\n   - Value: `<paste token ·ªü ƒë√¢y>`\n\n### **B∆∞·ªõc 3: Test trong Postman**\n\nSau khi c√≥ JWT token, b·∫°n c√≥ th·ªÉ test c√°c endpoints sau:\n- ‚úÖ Get My Info (`/auth/me`)\n- ‚úÖ Submit KYC (`POST /kyc`)\n- ‚úÖ Get My KYC (`GET /kyc/me`)\n- ‚úÖ Link Wallet (optional)\n- ‚úÖ Admin mint NFT cho user\n\n### **L∆∞u √Ω:**\n- JWT token h·∫øt h·∫°n sau 7 ng√†y (ho·∫∑c theo config)\n- N·∫øu token h·∫øt h·∫°n, login l·∫°i b·∫±ng browser\n- User c√≥ th·ªÉ d√πng app m√† KH√îNG c·∫ßn link wallet!"
          }
        }
      ]
    },
    {
      "name": "1. Health Checks",
      "item": [
        {
          "name": "Auth Service Health",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "http://localhost:4010/health",
              "protocol": "http",
              "host": ["localhost"],
              "port": "4010",
              "path": ["health"]
            }
          }
        },
        {
          "name": "KYC Service Health",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "http://localhost:4007/health",
              "protocol": "http",
              "host": ["localhost"],
              "port": "4007",
              "path": ["health"]
            }
          }
        },
        {
          "name": "User Service Health",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "http://localhost:4006/health",
              "protocol": "http",
              "host": ["localhost"],
              "port": "4006",
              "path": ["health"]
            }
          }
        },
        {
          "name": "Admin Service Health",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "http://localhost:4003/health",
              "protocol": "http",
              "host": ["localhost"],
              "port": "4003",
              "path": ["health"]
            }
          }
        },
        {
          "name": "Blockchain Service Health",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "http://localhost:4004/health",
              "protocol": "http",
              "host": ["localhost"],
              "port": "4004",
              "path": ["health"]
            }
          }
        },
        {
          "name": "IPFS Service Health",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "http://localhost:4002/health",
              "protocol": "http",
              "host": ["localhost"],
              "port": "4002",
              "path": ["health"]
            }
          }
        }
      ]
    },
    {
      "name": "2. Gmail OAuth Login (BROWSER ONLY)",
      "item": [
        {
          "name": "üåê Step 1: Open in Browser",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "http://localhost:4010/auth/google",
              "protocol": "http",
              "host": ["localhost"],
              "port": "4010",
              "path": ["auth", "google"]
            },
            "description": "‚ö†Ô∏è **KH√îNG TH·ªÇ CH·∫†Y REQUEST N√ÄY TRONG POSTMAN!**\n\n**L√†m th·∫ø n√†o:**\n1. Copy URL: `http://localhost:4010/auth/google`\n2. M·ªü **Browser** (Chrome/Edge/Firefox)\n3. Paste URL v√†o browser v√† Enter\n4. Ch·ªçn t√†i kho·∫£n Gmail ƒë·ªÉ login\n5. Sau khi login th√†nh c√¥ng, browser s·∫Ω redirect v·ªÅ:\n   ```\n   http://localhost:3000?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...\n   ```\n6. **Copy JWT token** t·ª´ URL (ph·∫ßn sau `?token=`)\n7. Paste v√†o Environment variable `jwt_token`\n8. Ti·∫øp t·ª•c test c√°c endpoint kh√°c trong Postman\n\n**T·∫°i sao ph·∫£i d√πng Browser?**\n- Google OAuth y√™u c·∫ßu user interaction (ch·ªçn account, consent)\n- Postman kh√¥ng support OAuth popup/redirect flow\n- JWT token ƒë∆∞·ª£c tr·∫£ v·ªÅ qua URL redirect"
          }
        },
        {
          "name": "‚úÖ Step 2: Get My Info (After Login)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"User logged in\", function () {",
                  "    pm.response.to.have.status(200);",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.eql(true);",
                  "    ",
                  "    // Save user info to environment",
                  "    pm.environment.set(\"user_id\", jsonData.user._id);",
                  "    pm.environment.set(\"user_email\", jsonData.user.email);",
                  "    pm.environment.set(\"user_wallet\", jsonData.user.walletAddress || \"\");",
                  "    ",
                  "    console.log(\"‚úÖ User ID: \" + jsonData.user._id);",
                  "    console.log(\"üìß Email: \" + jsonData.user.email);",
                  "    console.log(\"üëõ Wallet: \" + (jsonData.user.walletAddress || \"Not linked yet\"));",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{jwt_token}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "http://localhost:4010/auth/me",
              "protocol": "http",
              "host": ["localhost"],
              "port": "4010",
              "path": ["auth", "me"]
            },
            "description": "**Sau khi login Gmail th√†nh c√¥ng:**\n\n1. Paste JWT token v√†o Environment variable `jwt_token`\n2. Ch·∫°y request n√†y ƒë·ªÉ verify token\n3. Response s·∫Ω ch·ª©a:\n   - `userId`: ID c·ªßa user trong database\n   - `email`: Email t·ª´ Gmail\n   - `emailVerified`: true/false\n   - `walletAddress`: null (n·∫øu ch∆∞a link wallet)\n   - `authMethods`: [\"google\"] ho·∫∑c [\"google\", \"wallet\"]"
          }
        },
        {
          "name": "üö™ Logout",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{jwt_token}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "http://localhost:4010/auth/logout",
              "protocol": "http",
              "host": ["localhost"],
              "port": "4010",
              "path": ["auth", "logout"]
            },
            "description": "Logout - clear session v√† token"
          }
        }
      ]
    },
    {
      "name": "3. KYC Verification (userId-based)",
      "item": [
        {
          "name": "‚úÖ Submit KYC (with JWT)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"KYC submitted successfully\", function () {",
                  "    pm.response.to.have.status(200);",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.eql(true);",
                  "    pm.expect(jsonData.data.status).to.eql(\"verified\");",
                  "    ",
                  "    console.log(\"‚úÖ KYC Verified!\");",
                  "    console.log(\"üìß Email: \" + jsonData.data.email);",
                  "    console.log(\"üë§ Full Name: \" + jsonData.data.fullName);",
                  "    console.log(\"üÜî ID Number: \" + jsonData.data.idNumber);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{jwt_token}}",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"fullName\": \"Nguyen Van A\",\n  \"idNumber\": \"123456789012\"\n}"
            },
            "url": {
              "raw": "http://localhost:4007/kyc",
              "protocol": "http",
              "host": ["localhost"],
              "port": "4007",
              "path": ["kyc"]
            },
            "description": "**üÜï THAY ƒê·ªîI L·ªöN:**\n\n**TR∆Ø·ªöC:**\n```json\n{\n  \"walletAddress\": \"0x...\",\n  \"fullName\": \"...\",\n  \"idNumber\": \"...\"\n}\n```\n\n**SAU (HI·ªÜN T·∫†I):**\n```json\n{\n  \"fullName\": \"...\",\n  \"idNumber\": \"...\"\n}\n```\n\n**Gi·∫£i th√≠ch:**\n- `userId` v√† `email` ƒë∆∞·ª£c l·∫•y T·ª∞ ƒê·ªòNG t·ª´ JWT token\n- Kh√¥ng c·∫ßn g·ª≠i `walletAddress` n·ªØa\n- Wallet l√† OPTIONAL, c√≥ th·ªÉ link sau\n- KYC Service t·ª± ƒë·ªông:\n  1. Extract userId/email t·ª´ JWT\n  2. Create KYC record\n  3. Auto verify (status: \"verified\")\n  4. Notify User Service ƒë·ªÉ update profile"
          }
        },
        {
          "name": "üìã Get My KYC",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{jwt_token}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "http://localhost:4007/kyc/me",
              "protocol": "http",
              "host": ["localhost"],
              "port": "4007",
              "path": ["kyc", "me"]
            },
            "description": "Get KYC c·ªßa user hi·ªán t·∫°i (d√πng userId t·ª´ JWT)"
          }
        },
        {
          "name": "‚úîÔ∏è Check My Verified Status",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{jwt_token}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "http://localhost:4007/kyc/me/verified",
              "protocol": "http",
              "host": ["localhost"],
              "port": "4007",
              "path": ["kyc", "me", "verified"]
            },
            "description": "Check xem user hi·ªán t·∫°i ƒë√£ verified ch∆∞a"
          }
        },
        {
          "name": "üìä Get All Verified Users",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "http://localhost:4007/verified/all",
              "protocol": "http",
              "host": ["localhost"],
              "port": "4007",
              "path": ["verified", "all"]
            }
          }
        },
        {
          "name": "üìà KYC Statistics",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "http://localhost:4007/statistics",
              "protocol": "http",
              "host": ["localhost"],
              "port": "4007",
              "path": ["statistics"]
            }
          }
        }
      ]
    },
    {
      "name": "4. Wallet Linking (OPTIONAL)",
      "item": [
        {
          "name": "ÔøΩ README - Wallet Linking Explained",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "http://localhost:4010/health",
              "protocol": "http",
              "host": ["localhost"],
              "port": "4010",
              "path": ["health"]
            },
            "description": "## ÔøΩüîó GI·∫¢I TH√çCH: WALLET LINKING L√Ä G√å?\n\n### **T·∫†I SAO C·∫¶N WALLET LINKING?**\n\n**Tr∆∞·ªõc ƒë√¢y (Workflow c≈©):**\n```\n‚ùå User PH·∫¢I c√≥ MetaMask t·ª´ ƒë·∫ßu\n‚ùå Sign message ƒë·ªÉ login\n‚ùå Kh√≥ ti·∫øp c·∫≠n v·ªõi ng∆∞·ªùi kh√¥ng bi·∫øt crypto\n```\n\n**B√¢y gi·ªù (Workflow m·ªõi):**\n```\n‚úÖ User login b·∫±ng Gmail (d·ªÖ!)\n‚úÖ L√†m KYC (x√°c minh danh t√≠nh)\n‚úÖ C√≥ th·ªÉ d√πng app ngay\n\nüîó [OPTIONAL] Link wallet sau n·∫øu mu·ªën:\n   - Mua/b√°n NFT\n   - S·ªü h·ªØu NFT\n   - Nh·∫≠n payment t·ª´ giao d·ªãch\n```\n\n---\n\n### **WALLET LINKING HO·∫†T ƒê·ªòNG NH∆Ø TH·∫æ N√ÄO?**\n\n#### **B∆∞·ªõc 1: User ƒë√£ login Gmail**\n```\nüë§ User: example@gmail.com\n‚úÖ KYC: ƒê√£ verify\n‚ùå Wallet: CH∆ØA C√ì\n\n‚Üí User c√≥ th·ªÉ:\n   ‚úÖ Xem NFT\n   ‚úÖ Xem marketplace\n   ‚úÖ Qu·∫£n l√Ω profile\n   \n‚Üí User KH√îNG th·ªÉ:\n   ‚ùå Mua/b√°n NFT (c·∫ßn wallet)\n   ‚ùå Mint NFT (c·∫ßn wallet)\n   ‚ùå Nh·∫≠n ti·ªÅn (c·∫ßn wallet)\n```\n\n#### **B∆∞·ªõc 2: User mu·ªën link wallet**\n```\n1Ô∏è‚É£ User v√†o Settings ‚Üí Click \"Connect Wallet\"\n\n2Ô∏è‚É£ Ch·ªçn ƒë·ªãa ch·ªâ v√≠ t·ª´ Ganache:\n   V√≠ d·ª•: 0x742d35Cc6634C0532925a3b844Bc9e7595f0bEb2\n   (T·ª´ mnemonic: \"arm either chef prosper...\")\n\n3Ô∏è‚É£ G·ª≠i request l√™n server:\n   POST /auth/link-wallet/message\n   Body: { walletAddress: \"0x742d35...\" }\n\n4Ô∏è‚É£ Server tr·∫£ v·ªÅ message:\n   \"Link wallet 0x742d35... to account example@gmail.com\"\n\n5Ô∏è‚É£ User PH·∫¢I k√Ω message n√†y b·∫±ng MetaMask\n   ‚Üí Ch·ª©ng minh user s·ªü h·ªØu wallet ƒë√≥!\n   ‚Üí Ch·ªâ ng∆∞·ªùi c√≥ private key m·ªõi k√Ω ƒë∆∞·ª£c\n\n6Ô∏è‚É£ G·ª≠i signature l√™n server:\n   POST /auth/link-wallet\n   Body: {\n     walletAddress: \"0x742d35...\",\n     signature: \"0xabc123...\"\n   }\n\n7Ô∏è‚É£ Server verify signature:\n   ‚úÖ Signature h·ª£p l·ªá\n   ‚úÖ Wallet ch∆∞a b·ªã link b·ªüi user kh√°c\n   ‚úÖ L∆∞u walletAddress v√†o account\n```\n\n#### **B∆∞·ªõc 3: Sau khi link th√†nh c√¥ng**\n```\nüë§ User: example@gmail.com\n‚úÖ KYC: ƒê√£ verify\n‚úÖ Wallet: 0x742d35Cc6634C0532925a3b844Bc9e7595f0bEb2\n\n‚Üí User gi·ªù c√≥ th·ªÉ:\n   ‚úÖ Mua/b√°n NFT\n   ‚úÖ Mint NFT (admin mint cho user)\n   ‚úÖ Nh·∫≠n payment\n   ‚úÖ Login b·∫±ng Gmail HO·∫∂C Wallet\n```\n\n---\n\n### **TEST TRONG POSTMAN NH∆Ø TH·∫æ N√ÄO?**\n\n‚ö†Ô∏è **V·∫§N ƒê·ªÄ**: Postman KH√îNG C√ì MetaMask ƒë·ªÉ sign message!\n\n#### **GI·∫¢I PH√ÅP: D√πng Node.js script ƒë·ªÉ generate signature**\n\n**T·∫°o file `generate-signature.js`:**\n```javascript\nconst { ethers } = require('ethers');\n\n// Private key t·ª´ Ganache (account ƒë·∫ßu ti√™n)\nconst PRIVATE_KEY = '0x...(copy t·ª´ Ganache)';\nconst wallet = new ethers.Wallet(PRIVATE_KEY);\n\n// Message t·ª´ Step 1\nconst message = 'Link wallet 0x742d35... to account example@gmail.com';\n\n// Sign message\nwallet.signMessage(message).then(signature => {\n  console.log('Wallet Address:', wallet.address);\n  console.log('Message:', message);\n  console.log('Signature:', signature);\n  console.log('');\n  console.log('‚úÖ Copy signature n√†y v√†o Postman!');\n});\n```\n\n**Ch·∫°y script:**\n```bash\nnode generate-signature.js\n```\n\n**Output:**\n```\nWallet Address: 0x742d35Cc6634C0532925a3b844Bc9e7595f0bEb2\nMessage: Link wallet 0x742d35... to account example@gmail.com\nSignature: 0xabc123def456...\n\n‚úÖ Copy signature n√†y v√†o Postman!\n```\n\n---\n\n### **LU·ªíNG TEST TRONG POSTMAN:**\n\n```\n1Ô∏è‚É£ Login Gmail (Browser) ‚Üí Get JWT token\n\n2Ô∏è‚É£ Submit KYC (Postman)\n   POST /kyc\n   Body: { fullName: \"Nguyen Van A\", idNumber: \"123456789012\" }\n\n3Ô∏è‚É£ Get Link Message (Postman)\n   POST /auth/link-wallet/message\n   Body: { walletAddress: \"0x742d35...\" }\n   \n   Response: {\n     message: \"Link wallet 0x742d35... to account example@gmail.com\"\n   }\n\n4Ô∏è‚É£ Generate Signature (Node.js script)\n   node generate-signature.js\n   ‚Üí Copy signature: 0xabc123...\n\n5Ô∏è‚É£ Link Wallet (Postman)\n   POST /auth/link-wallet\n   Body: {\n     walletAddress: \"0x742d35...\",\n     signature: \"0xabc123...\"\n   }\n   \n   Response: {\n     success: true,\n     user: {\n       email: \"example@gmail.com\",\n       walletAddress: \"0x742d35...\",\n       authMethods: [\"google\", \"wallet\"]\n     }\n   }\n\n6Ô∏è‚É£ Verify (Postman)\n   GET /auth/me\n   \n   Response: {\n     email: \"example@gmail.com\",\n     walletAddress: \"0x742d35...\",  ‚Üê ‚úÖ ƒê√£ link!\n     kycVerified: true\n   }\n```\n\n---\n\n### **T·∫†I SAO C·∫¶N SIGNATURE?**\n\n**N·∫øu KH√îNG c√≥ signature:**\n```javascript\n‚ùå Ai c≈©ng c√≥ th·ªÉ l·∫•y ƒë·ªãa ch·ªâ wallet c·ªßa ng∆∞·ªùi kh√°c\n‚ùå Paste v√†o form v√† claim l√† c·ªßa m√¨nh\n‚ùå V√≠ d·ª•: Copy wallet c·ªßa Elon Musk v√† claim ownership!\n‚ùå ‚Üí L·ªñI B·∫¢O M·∫¨T NGHI√äM TR·ªåNG!\n```\n\n**V·ªõi signature:**\n```javascript\n‚úÖ User ph·∫£i sign message b·∫±ng private key\n‚úÖ Ch·ªâ ng∆∞·ªùi c√≥ private key m·ªõi sign ƒë∆∞·ª£c\n‚úÖ Backend verify ƒë∆∞·ª£c user th·ª±c s·ª± s·ªü h·ªØu wallet\n‚úÖ Message ch·ª©a email ‚Üí Kh√¥ng th·ªÉ reuse cho account kh√°c\n‚úÖ ‚Üí AN TO√ÄN!\n```\n\n**C∆° ch·∫ø verify:**\n```javascript\n// Backend l√†m:\n1. Nh·∫≠n: walletAddress + signature\n2. Recover address t·ª´ signature:\n   recoveredAddress = ethers.verifyMessage(message, signature)\n3. So s√°nh:\n   if (recoveredAddress === walletAddress) {\n     ‚úÖ H·ª£p l·ªá - User s·ªü h·ªØu wallet\n   } else {\n     ‚ùå Kh√¥ng h·ª£p l·ªá - Signature gi·∫£ m·∫°o\n   }\n```\n\n---\n\n### **T√ìM L·∫†I:**\n\n```\nüìß Login Gmail\n   ‚Üì\n‚úÖ L√†m KYC\n   ‚Üì\nüéØ D√πng app (xem NFT, marketplace)\n   ‚Üì\nüîó [OPTIONAL] Link wallet:\n   1. Get message t·ª´ server\n   2. Sign message (MetaMask ho·∫∑c Node.js script)\n   3. G·ª≠i signature l√™n server\n   4. Server verify ‚Üí Link th√†nh c√¥ng\n   ‚Üì\nüíé C√≥ th·ªÉ mua/b√°n/s·ªü h·ªØu NFT!\n```\n\n**Wallet linking l√† OPTIONAL - User c√≥ th·ªÉ d√πng app m√† kh√¥ng c·∫ßn wallet!**\n\n---\n\n**Ti·∫øp t·ª•c v·ªõi c√°c steps b√™n d∆∞·ªõi ƒë·ªÉ test! üëá**"
          }
        },
        {
          "name": "üîó Step 1: Get Link Message",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Message generated\", function () {",
                  "    pm.response.to.have.status(200);",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.eql(true);",
                  "    ",
                  "    console.log(\"üìù Message to sign:\");",
                  "    console.log(jsonData.message);",
                  "    console.log(\"\");",
                  "    console.log(\"‚ö†Ô∏è NEXT STEP:\");",
                  "    console.log(\"1. Copy message ·ªü tr√™n\");",
                  "    console.log(\"2. D√πng Node.js script (xem README) ƒë·ªÉ generate signature\");",
                  "    console.log(\"3. Paste signature v√†o Step 2\");",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{jwt_token}}",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"walletAddress\": \"0x742d35Cc6634C0532925a3b844Bc9e7595f0bEb2\"\n}"
            },
            "url": {
              "raw": "http://localhost:4010/auth/link-wallet/message",
              "protocol": "http",
              "host": ["localhost"],
              "port": "4010",
              "path": ["auth", "link-wallet", "message"]
            },
            "description": "**üéØ M·ª§C ƒê√çCH:**\nL·∫•y message c·∫ßn k√Ω ƒë·ªÉ link wallet v·ªõi account Gmail.\n\n**üìã INPUT:**\n```json\n{\n  \"walletAddress\": \"0x742d35...\"\n}\n```\n‚Üí ƒê·ªãa ch·ªâ v√≠ t·ª´ Ganache (account 0)\n‚Üí Ch·∫°y Ganache v·ªõi mnemonic:\n  \"arm either chef prosper fish lonely rigid antique dawn stumble wife camera\"\n\n**üì§ OUTPUT:**\n```json\n{\n  \"success\": true,\n  \"message\": \"Link wallet 0x742d35... to account example@gmail.com\"\n}\n```\n\n**‚ö†Ô∏è QUAN TR·ªåNG:**\n- Message n√†y ch·ª©a C·∫¢ wallet address V√Ä email\n- Ph·∫£i k√Ω message n√†y b·∫±ng private key c·ªßa wallet\n- Signature ch·ªâ h·ª£p l·ªá cho account n√†y\n\n**NEXT STEP:**\n1. Copy message t·ª´ response\n2. D√πng Node.js script ƒë·ªÉ generate signature (xem README)\n3. Paste signature v√†o Step 2"
          }
        },
        {
          "name": "üîó Step 2: Link Wallet with Signature",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Wallet linked successfully\", function () {",
                  "    pm.response.to.have.status(200);",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.eql(true);",
                  "    ",
                  "    pm.environment.set(\"user_wallet\", jsonData.user.walletAddress);",
                  "    ",
                  "    console.log(\"‚úÖ Wallet linked successfully!\");",
                  "    console.log(\"üëõ Wallet: \" + jsonData.user.walletAddress);",
                  "    console.log(\"ÔøΩ Email: \" + jsonData.user.email);",
                  "    console.log(\"ÔøΩüîê Auth methods: \" + jsonData.user.authMethods.join(\", \"));",
                  "    console.log(\"\");",
                  "    console.log(\"üéâ User gi·ªù c√≥ th·ªÉ:\");",
                  "    console.log(\"   - Mua/b√°n NFT\");",
                  "    console.log(\"   - S·ªü h·ªØu NFT\");",
                  "    console.log(\"   - Nh·∫≠n payment\");",
                  "    console.log(\"   - Login b·∫±ng Gmail HO·∫∂C Wallet\");",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{jwt_token}}",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"walletAddress\": \"0x742d35Cc6634C0532925a3b844Bc9e7595f0bEb2\",\n  \"signature\": \"0x...(paste signature t·ª´ Node.js script)...\"\n}"
            },
            "url": {
              "raw": "http://localhost:4010/auth/link-wallet",
              "protocol": "http",
              "host": ["localhost"],
              "port": "4010",
              "path": ["auth", "link-wallet"]
            },
            "description": "**üéØ M·ª§C ƒê√çCH:**\nLink wallet address v·ªõi Gmail account (b·∫±ng c√°ch verify signature).\n\n**üìã INPUT:**\n```json\n{\n  \"walletAddress\": \"0x742d35...\",\n  \"signature\": \"0xabc123...\"  ‚Üê T·ª´ Node.js script\n}\n```\n\n**üîê SERVER X·ª¨ L√ù:**\n```javascript\n1. Verify signature:\n   recoveredAddress = ethers.verifyMessage(message, signature)\n   \n2. Ki·ªÉm tra:\n   ‚úÖ recoveredAddress === walletAddress?\n   ‚úÖ Wallet ch∆∞a b·ªã link b·ªüi user kh√°c?\n   \n3. N·∫øu h·ª£p l·ªá:\n   - Update User.walletAddress = \"0x742d35...\"\n   - Add authMethod: \"wallet\"\n   - Update KYC.walletAddress\n   - Update UserProfile.walletAddress\n```\n\n**üì§ OUTPUT:**\n```json\n{\n  \"success\": true,\n  \"message\": \"Wallet linked successfully\",\n  \"user\": {\n    \"email\": \"example@gmail.com\",\n    \"walletAddress\": \"0x742d35...\",\n    \"authMethods\": [\"google\", \"wallet\"],\n    \"walletLinkedAt\": \"2025-10-24T...\"\n  }\n}\n```\n\n**‚úÖ SAU KHI LINK TH√ÄNH C√îNG:**\n- User c√≥ 2 c√°ch login: Gmail HO·∫∂C Wallet\n- User c√≥ th·ªÉ mua/b√°n/s·ªü h·ªØu NFT\n- KYC v√† UserProfile ƒë∆∞·ª£c update v·ªõi wallet\n- Bi·∫øn `{{user_wallet}}` ƒë∆∞·ª£c set t·ª± ƒë·ªông\n\n**üß™ VERIFY:**\nCh·∫°y request `GET /auth/me` ƒë·ªÉ verify wallet ƒë√£ ƒë∆∞·ª£c link!"
          }
        },
        {
          "name": "üîì Unlink Wallet",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{jwt_token}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "http://localhost:4010/auth/unlink-wallet",
              "protocol": "http",
              "host": ["localhost"],
              "port": "4010",
              "path": ["auth", "unlink-wallet"]
            },
            "description": "Unlink wallet kh·ªèi account (rare use case)"
          }
        }
      ]
    },
    {
      "name": "5. Property Management",
      "item": [
        {
          "name": "Create Property",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Property created\", function () {",
                  "    pm.response.to.have.status(201);",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.eql(true);",
                  "    pm.environment.set(\"property_id\", jsonData.data._id);",
                  "    console.log(\"‚úÖ Property ID: \" + jsonData.data._id);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"title\": \"Luxury Villa in District 2\",\n  \"description\": \"Beautiful 3-bedroom villa with swimming pool and garden\",\n  \"propertyType\": \"villa\",\n  \"address\": {\n    \"street\": \"123 Thao Dien\",\n    \"ward\": \"Thao Dien\",\n    \"district\": \"District 2\",\n    \"city\": \"Ho Chi Minh City\",\n    \"country\": \"Vietnam\"\n  },\n  \"area\": 250,\n  \"price\": 15000000000,\n  \"currency\": \"VND\",\n  \"bedrooms\": 3,\n  \"bathrooms\": 3,\n  \"features\": [\"Swimming Pool\", \"Garden\", \"Parking\", \"Security\"],\n  \"owner\": \"{{user_id}}\",\n  \"legalStatus\": \"verified\"\n}"
            },
            "url": {
              "raw": "http://localhost:4003/properties",
              "protocol": "http",
              "host": ["localhost"],
              "port": "4003",
              "path": ["properties"]
            },
            "description": "‚ö†Ô∏è **L∆ØU √ù**: `owner` gi·ªù l√† `userId` (t·ª´ Gmail OAuth), kh√¥ng ph·∫£i `walletAddress`"
          }
        },
        {
          "name": "Get Property Detail",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "http://localhost:4003/properties/{{property_id}}",
              "protocol": "http",
              "host": ["localhost"],
              "port": "4003",
              "path": ["properties", "{{property_id}}"]
            }
          }
        },
        {
          "name": "Get All Properties",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "http://localhost:4003/properties",
              "protocol": "http",
              "host": ["localhost"],
              "port": "4003",
              "path": ["properties"]
            }
          }
        }
      ]
    },
    {
      "name": "6. IPFS Upload",
      "item": [
        {
          "name": "Upload Property Image",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Image uploaded\", function () {",
                  "    pm.response.to.have.status(200);",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.eql(true);",
                  "    pm.environment.set(\"image_cid\", jsonData.data.cid);",
                  "    console.log(\"‚úÖ Image CID: \" + jsonData.data.cid);",
                  "    console.log(\"üîó Gateway URL: \" + jsonData.data.gateway);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [],
            "body": {
              "mode": "formdata",
              "formdata": [
                {
                  "key": "file",
                  "type": "file",
                  "src": [],
                  "description": "Ch·ªçn file ·∫£nh property t·ª´ m√°y t√≠nh"
                },
                {
                  "key": "propertyId",
                  "value": "{{property_id}}",
                  "type": "text"
                }
              ]
            },
            "url": {
              "raw": "http://localhost:4002/upload/image",
              "protocol": "http",
              "host": ["localhost"],
              "port": "4002",
              "path": ["upload", "image"]
            },
            "description": "‚ö†Ô∏è Ch·ªçn file ·∫£nh trong tab **Body ‚Üí form-data ‚Üí file**"
          }
        },
        {
          "name": "Upload NFT Metadata (Auto-Generated)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Metadata uploaded\", function () {",
                  "    pm.response.to.have.status(200);",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.eql(true);",
                  "    pm.environment.set(\"metadata_cid\", jsonData.data.cid);",
                  "    console.log(\"‚úÖ Metadata CID: \" + jsonData.data.cid);",
                  "    console.log(\"üîó Token URI: ipfs://\" + jsonData.data.cid);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"propertyId\": \"{{property_id}}\",\n  \"imageCID\": \"{{image_cid}}\"\n}"
            },
            "url": {
              "raw": "http://localhost:4002/upload/metadata",
              "protocol": "http",
              "host": ["localhost"],
              "port": "4002",
              "path": ["upload", "metadata"]
            },
            "description": "‚ú® Auto-generate metadata t·ª´ property data"
          }
        },
        {
          "name": "Get Metadata Content",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "http://localhost:4002/content/{{metadata_cid}}",
              "protocol": "http",
              "host": ["localhost"],
              "port": "4002",
              "path": ["content", "{{metadata_cid}}"]
            },
            "description": "Preview metadata JSON"
          }
        }
      ]
    },
    {
      "name": "7. NFT Minting (Admin mints for User)",
      "item": [
        {
          "name": "üé® Admin Mints NFT for User",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"NFT minted successfully\", function () {",
                  "    pm.response.to.have.status(200);",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.eql(true);",
                  "    pm.environment.set(\"token_id\", jsonData.data.tokenId);",
                  "    ",
                  "    console.log(\"‚úÖ NFT Minted!\");",
                  "    console.log(\"üé´ Token ID: \" + jsonData.data.tokenId);",
                  "    console.log(\"üë§ Owner: \" + jsonData.data.recipient);",
                  "    console.log(\"üîó Token URI: \" + jsonData.data.tokenURI);",
                  "    console.log(\"‚õΩ Gas Used: \" + jsonData.data.gasUsed);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"recipient\": \"{{user_wallet}}\",\n  \"tokenURI\": \"ipfs://{{metadata_cid}}\"\n}"
            },
            "url": {
              "raw": "http://localhost:4004/mint",
              "protocol": "http",
              "host": ["localhost"],
              "port": "4004",
              "path": ["mint"]
            },
            "description": "**üÜï WORKFLOW M·ªöI:**\n\n1. User login Gmail ‚Üí KYC ‚Üí (Optional: Link wallet)\n2. User t·∫°o property\n3. User upload ·∫£nh ‚Üí IPFS\n4. IPFS auto-generate metadata\n5. **ADMIN** mint NFT cho user\n6. User s·ªü h·ªØu NFT ngay l·∫≠p t·ª©c!\n\n**L∆∞u √Ω:**\n- `recipient` = `user_wallet` (n·∫øu user ƒë√£ link wallet)\n- Admin k√Ω transaction b·∫±ng ADMIN_PRIVATE_KEY\n- User nh·∫≠n ownership c·ªßa NFT\n- Kh√¥ng c·∫ßn transfer th√™m!"
          }
        },
        {
          "name": "‚úÖ Verify NFT Ownership",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"User owns the NFT\", function () {",
                  "    pm.response.to.have.status(200);",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.eql(true);",
                  "    pm.expect(jsonData.data.owner.toLowerCase()).to.eql(pm.environment.get(\"user_wallet\").toLowerCase());",
                  "    ",
                  "    console.log(\"‚úÖ Verified: User owns NFT #\" + jsonData.data.tokenId);",
                  "    console.log(\"üë§ Owner: \" + jsonData.data.owner);",
                  "    console.log(\"üîó Token URI: \" + jsonData.data.tokenURI);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "http://localhost:4004/nft/{{token_id}}",
              "protocol": "http",
              "host": ["localhost"],
              "port": "4004",
              "path": ["nft", "{{token_id}}"]
            },
            "description": "Verify user s·ªü h·ªØu NFT"
          }
        },
        {
          "name": "üìã Get User's NFTs",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "http://localhost:4004/nfts/{{user_wallet}}",
              "protocol": "http",
              "host": ["localhost"],
              "port": "4004",
              "path": ["nfts", "{{user_wallet}}"]
            },
            "description": "Get t·∫•t c·∫£ NFT c·ªßa user"
          }
        },
        {
          "name": "üé´ Get Token Counter",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "http://localhost:4004/token-counter",
              "protocol": "http",
              "host": ["localhost"],
              "port": "4004",
              "path": ["token-counter"]
            },
            "description": "Get t·ªïng s·ªë NFT ƒë√£ mint"
          }
        }
      ]
    },
    {
      "name": "8. NFT Management (Owner Operations)",
      "item": [
        {
          "name": "Get NFT Details (Admin Service)",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "http://localhost:4003/nfts/{{token_id}}",
              "protocol": "http",
              "host": ["localhost"],
              "port": "4003",
              "path": ["nfts", "{{token_id}}"]
            },
            "description": "Get NFT details t·ª´ Admin Service (property info, owner, price, etc.)"
          }
        },
        {
          "name": "List NFT for Sale",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"price\": \"1000000000000000000\",\n  \"seller\": \"{{user_wallet}}\",\n  \"listingId\": 1\n}"
            },
            "url": {
              "raw": "http://localhost:4003/nfts/{{token_id}}/list",
              "protocol": "http",
              "host": ["localhost"],
              "port": "4003",
              "path": ["nfts", "{{token_id}}", "list"]
            },
            "description": "List NFT for sale (price in wei: 1 ETH = 10^18 wei)"
          }
        },
        {
          "name": "Get Listed NFTs",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "http://localhost:4003/nfts/marketplace/listed",
              "protocol": "http",
              "host": ["localhost"],
              "port": "4003",
              "path": ["nfts", "marketplace", "listed"]
            }
          }
        }
      ]
    }
  ],
  "variable": [
    {
      "key": "jwt_token",
      "value": "",
      "type": "string",
      "description": "JWT token from Gmail OAuth (paste after login)"
    },
    {
      "key": "user_id",
      "value": "",
      "type": "string",
      "description": "User ID (from Auth Service)"
    },
    {
      "key": "user_email",
      "value": "",
      "type": "string",
      "description": "User email (from Gmail)"
    },
    {
      "key": "user_wallet",
      "value": "",
      "type": "string",
      "description": "User wallet address (after linking, optional)"
    },
    {
      "key": "property_id",
      "value": "",
      "type": "string"
    },
    {
      "key": "image_cid",
      "value": "",
      "type": "string"
    },
    {
      "key": "metadata_cid",
      "value": "",
      "type": "string"
    },
    {
      "key": "token_id",
      "value": "",
      "type": "string"
    },
    {
      "key": "admin_wallet",
      "value": "0xC6890b26A32d9d92aefbc8635C4588247529CdfE",
      "type": "string",
      "description": "Admin wallet address (for reference)"
    }
  ]
}
